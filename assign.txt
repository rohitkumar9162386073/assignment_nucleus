-- Qs.01
CREATE TABLE LMS_CUSTOMER_M_16911(
    Customer_ID VARCHAR(20) NOT NULL,
    First_Name VARCHAR(20) NOT NULL,
    Last_Name VARCHAR(20),
    Gender VARCHAR(1) NOT NULL,
    Date_Of_Birth DATE NOT NULL,
    Contact_Number VARCHAR(10) NOT NULL,
    Email_Address VARCHAR(20) NOT NULL,
    Monthly_Income NUMBER(8,2) NOT NULL,
    Profession VARCHAR(40),
    Total_Monthly_Expense NUMBER(8,2) NOT NULL,
    Designation VARCHAR(40),
    Company_Name VARCHAR(40)
    
);

-- Qs.02
CREATE TABLE LMS_PRODUCT_CATEGORY_M_16911(
    Category_ID VARCHAR(10) NOT NULL,
    Category_Name VARCHAR(50) NOT NULL,
    Asset_Based VARCHAR(1) NOT NULL,
    Description VARCHAR(150),
    SecuredLoan VARCHAR(2)NOT NULL,
    CONSTRAINT chk_Asset_Based CHECK (Asset_Based in ("Y", "N"))
    CONSTRAINT chk_SecuredLoan CHECK (SecuredLoan in ("U", "US"))
);

-- Qs.03
CREATE TABLE LMS_Product_M_16911(
    Product_Code VARCHAR(20) NOT NULL,
    Product_Name VARCHAR(100) NOT NULL,
    Product_Description VARCHAR(200),
    Max_Tenure NUMBER(2),
    Min_Tenure NUMBER(2)
);

-- Qs.04
CREATE TABLE LMS_AGREEMENT_DTL_16911(
    Agreement_ID VARCHAR(20) NOT NULL,
    Lesse_ID VARCHAR(100),
    Tenure NUMBER(2),
    ROI NUMBER(3,1),
    Loan_Amount NUMBER(10,2),
    Repayment_Frequency VARCHAR(2),
    Loan_DisbursaL_Date DATE,
    Status VARCHAR(10),
    Product_Code VARCHAR(20) NOT NULL,
    CONSTRAINT chk_Repayment_Frequency CHECK (Repayment_Frequency in ("M", "Y", "Q", "HY"))
    CONSTRAINT chk_Status CHECK (Status in ("Pending", "Approved", "Rejected", "Active", "Closed"))
    
);

-- Qs.05
CREATE TABLE LMS_REPAYSCH_DTL_16911(
    Agreement_id VARCHAR(20) NOT NULL,
    PropInstID NUMBER(8) NOT NULL, 
    Installment_Amount NUMBER(18, 5) NOT NULL, 
    Installment_Number NUMBER(3) NOT NULL, 
    Principal_Component Number(18, 5) NOT NULL,
    Interest_Component Number(18, 5) NOT NULL, 
    Balance_Principal_Amount NUMBER(18, 5) NOT NULL,
    Penalty_Charges NUMBER(8,2),
    Instsllment_Due_Date DATE NOT NULL
    
);

-- Qs.06
CREATE TABLE LMS_TXNTYPE_M_16911(
    Txn_Type VARCHAR(20) NOT NULL,
    Description_ VARCHAR(100),
    CONSTRAINT chk_Txn_Type CHECK (Txn_Type in ("Installment", "LPP"))
);

-- Qs.07
CREATE TABLE LMS_TXN_ADVICE_DTL_16911(
    Txn_Advice_ID Number(8) GENERATED BY DEFAULT AS IDENTITY,
    Adviceamt NUMBER(8,2) NOT NULL,
    AdviceDate DATE NOT NULL,
    Case_Id NUMBER(8) NOT NULL,
    TxnID NUMBER(8) NOT NULL,
    TxnType VARCHAR(20) NOT NULL
);

-- Qs.08
CREATE TABLE LMS_CHEQUE_DTL_16911(
    Cheque_Id NUMBER(8) NOT NULL,
    Payment_Mode VARCHAR(1) NOT NULL CONSTRAINT chk_Payment_Mode CHECK (Payment_Mode in ("C", "Q", "D", "T")),
    Cheque_Num VARCHAR(50) NOT NULL, -- Cheque_Num NUMBER(10)
    Cheque_Date DATE,
    Cheque_Amount NUMBER(10,2),
    Drwan_On_Bank VARCHAR(50),
    Deposit_Date DATE,
    Status VARCHAR(1)CONSTRAINT chk_Status CHECK (Status in ("C", "D", "X", "B"))
);

-- Qs.09
CREATE TABLE LMS_PAYMENT_DTL_16911(
    Payment_ID NUMBER(8) NOT NULL UNIQUE,
    Cheque_ID NUMBER(8) NOT NULL UNIQUE,
    Payment_Date DATE NOT NULL,
    Status VARCHAR(1) NOT NULL CONSTRAINT chk_Status CHECK (Status in ("C", "N")),
    Txn_Advice_Id NUMBER(8) NOT NULL
);
--SELECT * FROM LMS_PAYMENT_DTL_16911;



-- Qs.10
SELECT * FROM user_tables WHERE TABLE_NAME LIKE ('%16911');

-- Qs.11
ALTER TABLE LMS_CUSTOMER_M_16911
ADD CONSTRAINT LMS_CUSTOMER_M_PK_16911 PRIMARY KEY (Customer_ID);

ALTER TABLE LMS_PRODUCT_CATEGORY_M_16911
ADD CONSTRAINT LMS_PRODUCT_CAT_M_PK_16911 PRIMARY KEY (Category_ID);

ALTER TABLE LMS_PRODUCT_M_16911
ADD CONSTRAINT LMS_PRODUCT_M_PK_16911 PRIMARY KEY (Product_Code);

ALTER TABLE LMS_AGREEMENT_DTL_16911
ADD CONSTRAINT LMS_AGREEMENT_DTL_PK_16911 PRIMARY KEY (Agreement_ID);

ALTER TABLE LMS_REPAYSCH_DTL_16911
ADD CONSTRAINT LMS_REPAYSCH_DTL_PK_16911 PRIMARY KEY (PropInstID);

ALTER TABLE LMS_TXN_ADVICE_DTL_16911
ADD CONSTRAINT LMS_TXNTYPE_M_PK_16911 PRIMARY KEY (Txn_Type);

ALTER TABLE LMS_TXN_ADVICE_DTL_16911
ADD CONSTRAINT LMS_TXN_ADVICE_DTL_PK_16911 PRIMARY KEY (Txn_Advice_ID);

ALTER TABLE LMS_CHEQUE_DTL_16911
ADD CONSTRAINT LMS_CHEQUE_DTL_PK_16911 PRIMARY KEY (Cheque_ID);

ALTER TABLE LMS_PAYMENT_DTL_16911
ADD CONSTRAINT LMS_PAYMENT_DTL_PK_16911 PRIMARY KEY (Payment_ID);

-- qs 12
ALTER TABLE LMS_Product_M_16911
ADD CONSTRAINT LMS_Product_Cat_FK_16911 
FOREIGN KEY (Product_Category) REFERENCES LMS_Product_Category_M_16911 (Category_ID);

ALTER TABLE LMS_Agreement_DTL_16911
ADD CONSTRAINT LMS_Agreement_Dtl_FK1_16911
FOREIGN KEY (Lessee_ID) REFERENCES LMS_Customer_M_16911(Customer_ID);

ALTER TABLE LMS_Agreement_DTL_16911
ADD CONSTRAINT LMS_Agreement_Dtl_FK2_16911
FOREIGN KEY (Product_Code) REFERENCES LMS_Product_M_16911 (Product_Code);
 
ALTER TABLE LMS_Repaysch_DTL_16911
ADD CONSTRAINT LMS_Repaysch_DTL_FK_16911 
FOREIGN KEY (Agreement_Id) REFERENCES LMS_Agreement_DTL_16911 (Agreement_Id);

ALTER TABLE LMS_TXN_ADVICE_DTL_16911
ADD CONSTRAINT LMS_TXN_ADVICE_DTL_FK1_16911 
FOREIGN KEY (TxnType) REFERENCES LMS_TXNTYPE_M_16911 (Txn_Type);
 
ALTER TABLE LMS_TXN_ADVICE_DTL_16911
ADD CONSTRAINT LMS_TXN_ADVICE_DTL_FK2_16911 
FOREIGN KEY (Case_Id) REFERENCES LMS_AGREEMENT_DTL_16911 (Agreement_id);

ALTER TABLE LMS_TXN_ADVICE_DTL_16911
ADD CONSTRAINT LMS_TXN_ADVICE_DTL_FK3_16911 
FOREIGN KEY (TXN_ADVICE_ID) REFERENCES LMS_REPAYSCH_DTL_16911 (PropInstID);


ALTER TABLE LMS_PAYMENT_DTL_16911
ADD CONSTRAINT LMS_Payment_Dtl_FK1_16911
FOREIGN KEY (Cheque_Id) REFERENCES LMS_CHEQUE_DTL_16911(Cheque_id);

 
ALTER TABLE LMS_PAYMENT_DTL_16911
ADD CONSTRAINT LMS_Payment_Dtl_FK2_16911
FOREIGN KEY (Txn_Advice_Id) REFERENCES LMS_TXN_ADVICE_DTL_16911(Txn_Advice_id);

-- QS.13
ALTER TABLE LMS_CUSTOMER_M_16911 MODIFY Last_Name VARCHAR(30) NOT NULL;

-- QS.14
CREATE TABLE Customer2(
    ID VARCHAR(20) PRIMARY KEY,
    NAME VARCHAR(20) NOT NULL,
    EMAIL  VARCHAR(40) NOT NULL,
    PROFESSION   VARCHAR(40),
    INCOME NUMBER(8,2)
);

-- QS.15
DROP TABLE Customer2;

-- QS.17
FLASHBACK TABLE Customer2 TO BEFORE DROP;

-- QS.16
SHOW RECYCLEBIN ;

-- QS.18
ALTER TABLE Customer2 DROP COLUMN NAME;

desc Customer2;
select * from user_tables;
SELECT * FROM LMS_CHEQUE_DTL_16911;
SHOW RECYCLEBIN;

DESC LMS_PRODUCT_M_16911;
DESC LMS_TXNTYPE_M_16911;
LIST HISTORY DROPPED TABLE;

